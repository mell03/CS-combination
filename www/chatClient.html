<!DOCTYPE HTML>
<html>
<head>
 <meta charset="utf-8">

 <link rel="stylesheet" href="./main_style.css" >
 <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
 <script src='http://114.202.97.238:10000/check_user.cgi'></script>
 <script src="http://114.202.97.238:10000/get_camera_params.cgi"></script>
 <script type="text/javascript">
     function WebSocketTest()
     {
         if ("WebSocket" in window)
         {
             alert("WebSocket is supported by your Browser!");

             // Let us open a web socket
             var ws = new WebSocket("ws://114.202.97.238:8090");

             ws.onopen = function()
             {
                 // Web Socket is connected, send data using send()
                 ws.send("Message to send");
                 alert("Message is sent...");
             };

             ws.onmessage = function (evt)
             {
                 var received_msg = evt.data;
                 alert("Message is received..." + "\n" + received_msg);
             };

             ws.onclose = function()
             {
                 // websocket is closed.
                 alert("Connection is closed...");
             };
         }

         else
         {
             // The browser doesn't support WebSocket
             alert("WebSocket NOT supported by your Browser!");
         }
     }
 </script>
 <script>

     var PTZ_STOP	=1;
     var TILT_UP		=2;
     var TILT_UP_STOP=1;
     var TILT_DOWN	=0;
     var TILT_DOWN_STOP=3;
     var PAN_LEFT	=6;
     var PAN_LEFT_STOP=5;
     var PAN_RIGHT	=4;
     var PAN_RIGHT_STOP=7;
     var PTZ_LEFT_UP	=93;
     var PTZ_RIGHT_UP=92;
     var PTZ_LEFT_DOWN=91;
     var PTZ_RIGHT_DOWN=90;
     var PTZ_CENTER	=25;
     var PTZ_VPATROL	=26;
     var PTZ_VPATROL_STOP=27;
     var PTZ_HPATROL	=28;
     var PTZ_HPATROL_STOP=29;
     var PTZ_PELCO_D_HPATROL=20;
     var PTZ_PELCO_D_HPATROL_STOP=21;

     var IO_ON=94;
     var IO_OFF=95;
     function decoder_control_onestep(command)
     {
         action_zone.location='http://114.202.97.238:10000/decoder_control.cgi?onestep=1&command='+command;
     }

     function decoder_control(command)
     {
         action_zone.location='http://114.202.97.238:10000/decoder_control.cgi?command='+command;
     }
     function leftclicked()
     {
         (flip&0x02)?decoder_control_onestep(PAN_RIGHT):decoder_control_onestep(PAN_LEFT);
     }
     function rightclicked()
     {
         (flip&0x02)?decoder_control_onestep(PAN_LEFT):decoder_control_onestep(PAN_RIGHT);
     }
     function downclicked()
     {
         (flip&0x01)?decoder_control_onestep(TILT_UP):decoder_control_onestep(TILT_DOWN);
     }
     function upclicked()
     {
         (flip&0x01)?decoder_control_onestep(TILT_DOWN):decoder_control_onestep(TILT_UP);
     }
 </script>

 <script>
     if(!('webkitSpeechRecognition' in window)){
         $('#recognition_result').text('지원하지 않는 브라우저입니다.');
         console.log('미지원 브라우저');
     }
     else{
         var mic = new webkitSpeechRecognition();
         mic.continuous = false;
         mic.interimResults = true;
         mic.lang = 'ko-KR';
         //영어 : 'en-US'
         mic.onresult = function(e){
             var textResult = '', c = false;
             for(var i = e.resultIndex; i<e.results.length; ++i){
                 textResult += e.results[i][0].transcript;
                 c = e.results[i].isFinal;
             }
             if($('#recognition_result .cning').length <1 )
                 $('#recognition_result').html('<span class="cning"></span>');
             $('#recognition_result .cning').text(textResult);
             //if(c) $('#test .cning').removeClass('cning');
         };
         mic.onend = function(){
             $('#recognition_btn').text('시작하기');
             nowRecognizing = false;
         };
         mic.onstart = function(){
             $('#recognition_btn').text('말씀하세요');
             nowRecognizing = true;
         };
     }
 </script>
 <script>
     var nowRecognizing = false;
     function onclickB(){
         if(nowRecognizing){
             mic.stop();
             //$('#recognition_result').text('시작하기');
             //nowRecognizing = false;
         }
         else{
             mic.start();
             //$('#recognition_result').text('말씀하세요');
             //nowRecognizing = true;
         }
     }
 </script>
</head>
<body>

<div id="sse">
 <a href="javascript:WebSocketTest()">Run WebSocket</a>
</div>

<button id='recognition_btn' onclick='onclickB()' style="width:200px;height:100px;font-size:2em">시작하기</button>
<div id='recognition_result'>버튼을 클릭하고 말해주세요.</div>

<iframe name="action_zone" style="display:none"></iframe>

<div class='video_container'>
 <img src="http://114.202.97.238:10000/videostream.cgi?rate=0">
</div>


<button id ='camera_up' class='camera_control_btn' onclick=upclicked()>상</button>
<button class='camera_control_btn' onclick=downclicked()>하</button>
<button class='camera_control_btn' onclick=leftclicked()>좌</button>
<button class='camera_control_btn' onclick=rightclicked()>우</button>


<script>
    if(!('webkitSpeechRecognition' in window)){
        $('#recognition_result').text('지원하지 않는 브라우저입니다.');
        console.log('미지원 브라우저');
    }
</script>
</body>
</html>